<DBMIGRATION type="mod/dialogue" VERSION="2006041900">
  <TABLES>
    <TABLE name="dialogue_conversations">
      <FIELDS>
        <FIELD name="subject" method="PLAIN_SQL_UPDATE" type="varchar" length="100">
          <SQL_DETECT_USER>
           SELECT dc.userid
           FROM {$CFG->prefix}dialogue_conversations dc
           WHERE dc.id=RECORDID
          </SQL_DETECT_USER>
          <SQL_DETECT_COURSE>
           SELECT d.course
           FROM {$CFG->prefix}dialogue_conversations dc,
                {$CFG->prefix}dialogue d
           WHERE d.id = dc.dialogueid
                 AND dc.id = RECORDID
          </SQL_DETECT_COURSE>
        </FIELD>
      </FIELDS>
    </TABLE>
    <TABLE name="dialogue_entries">
      <FIELDS>
        <FIELD name="text" method="PLAIN_SQL_UPDATE" type="text" length="0">
          <SQL_DETECT_USER>
           SELECT de.userid
           FROM {$CFG->prefix}dialogue_entries de
           WHERE de.id = RECORDID
          </SQL_DETECT_USER>
          <SQL_DETECT_COURSE>
           SELECT d.course
           FROM {$CFG->prefix}dialogue_entries de,
                {$CFG->prefix}dialogue d
           WHERE d.id = de.dialogueid
                 AND de.id = RECORDID
          </SQL_DETECT_COURSE>
        </FIELD>
      </FIELDS>
    </TABLE>
    <TABLE name="dialogue">
      <FIELDS>
        <FIELD name="name" method="PHP_FUNCTION" type="varchar" length="255">
          <PHP_FUNCTION>
            migrate2utf8_dialogue_name(RECORDID)
          </PHP_FUNCTION>
        </FIELD>
        <FIELD name="intro" method="PHP_FUNCTION" type="text" length="0">
          <PHP_FUNCTION>
            migrate2utf8_dialogue_intro(RECORDID)
          </PHP_FUNCTION>
        </FIELD>
      </FIELDS>
    </TABLE>
  </TABLES>
</DBMIGRATION>
